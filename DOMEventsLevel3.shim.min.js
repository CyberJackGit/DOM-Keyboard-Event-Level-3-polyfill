/* DOM Keyboard Event Level 3 polyfill | @version 0.4 | MIT License | github.com/termi */
;(function(){
var f=void 0,g=!0,k=null,l=!1,m;try{m="a"==(new window.KeyboardEvent("keyup",{key:"a"})).key}catch(aa){m=l}
if(!m){var n=window,x=function(a,b){var c;try{c=document.createEvent("KeyboardEvent")}catch(e){c=document.createEvent("Event")}b=b||{};var d={},j,h;for(j in r)if(ba(r,j)&&(!s||!("key"==j||"char"==j)))d[j]=j in b&&(h=b[j])!==f?h:r[j];h=d.ctrlKey||l;var p=d.shiftKey||l,q=d.altKey||l,H=d.metaKey||l,R=d.altGraphKey||l,ca=3<u?((h?"Control":"")+(p?" Shift":"")+(q?" Alt":"")+(H?" Meta":"")+(R?" AltGraph":"")).trim():k,F=d.key,L=d["char"],M=d.location,t=F&&F.charCodeAt(0)||0,C=d.bubbles,D=d.cancelable,S=
l,t=d.keyCode=d.keyCode||t;d.which=d.which||t;v||(c.__keyCode=t,c.__charCode=t,c.__which=t);if("initKeyEvent"in c)c.initKeyEvent(a,C,D,n,h,q,p,H,t,t),S=g;else if("initKeyboardEvent"in c&&da)try{1==u?(c.initKeyboardEvent(a,C,D,n,F,M,h,p,q,H,R),c.__char=L):2==u?c.initKeyboardEvent(a,C,D,n,h,q,p,H,t,t):3==u?(c.initKeyboardEvent(a,C,D,n,F,M,h,q,p,H,R),c.__char=L):4==u?(c.initKeyboardEvent(a,C,D,n,F,M,ca,d.repeat,d.locale),c.__char=L):c.initKeyboardEvent(a,C,D,n,L,F,M,ca,d.repeat,d.locale),S=g}catch(ra){da=
l}S||c.initEvent(a,C,D,n);for(j in r)if(ba(r,j)&&(!s||!("key"==j||"char"==j))&&c[j]!=d[j])delete c[j],w(c,j,{writable:g,value:d[j]});"isTrusted"in c||(c.k=l);return c},y=function(a){return a&&!(a in ea)&&"U+"!==a.substring(0,2)},fa=function(a){var b=a.which||a.keyCode,c=this.i,e=z[b],d=!e&&A[b];(d=d&&0!==d.a||a.__key)||e&&e.b&&e.f||a.k===l?(b=this.h,"object"===typeof b&&"handleEvent"in b&&(c=b,b=b.handleEvent),b&&b.apply&&b.apply(c,arguments)):(c=c._||(c._={}),c._h_9e2__keyCode=b,"keyLocation"in a&&
(c._keyLocation=a.g))},ia=function(a){var b,c=a.which||a.keyCode,e=this._,d,j;if(!a.__stopNow){if(e&&"_h_9e2__keyCode"in e){b=e._h_9e2__keyCode;delete e._h_9e2__keyCode;if((d=z[b])&&B&&d.e)b=d.e;"keyLocation"in a&&"_keyLocation"in e&&(delete a.g,a.g=e._keyLocation);91>b&&(64<b&&c!=b&&!z[b])&&(d=d||(z[b]={}),d.e=b);j=d&&d.a||String.fromCharCode(b).toLowerCase();s=g;e=new x("keydown",a);s=l;delete e.keyLocation;delete e.__location;ga?(delete e.which,w(e,"which",{value:b})):e.__which=b;v?(delete e.keyCode,
w(e,"keyCode",{value:b})):e.__keyCode=b;e.__location=E.call(e);j&&(e.__key=j);e.__char=String.fromCharCode(c);G||(d=d||(d=z[c]=z[b]={}),a.shiftKey?d.d=e["char"]:d.b=e["char"]);b=!(a.target||this).dispatchEvent(e)}else b=!a.ctrlKey&&(e=z[c])&&1<("object"==typeof e?e.a||"":e).length?2:0;b&&(b===g&&a.preventDefault(),ha?a.stopImmediatePropagation():(a.__stopNow=g,a.stopPropagation()))}},I=1,J=2,K=3,ja=4,ka=5,la=n.Event.prototype,N=n.KeyboardEvent&&n.KeyboardEvent.prototype||la,G,O,P,Q,w=Object.defineProperty,
T=Object.getOwnPropertyDescriptor,U=function(a,b){return"__lookupGetter__"in a?a.__lookupGetter__(b):T?(T(a,b)||{}).get:f},V={keydown:k,keyup:k,keypress:k},ma=1,r={"char":"",key:"",location:0,ctrlKey:l,shiftKey:l,altKey:l,metaKey:l,repeat:l,locale:"",detail:0,bubbles:l,cancelable:l},ha="stopImmediatePropagation"in document.createEvent("Event"),na=Array.prototype.slice,oa=Function.prototype.bind||function(a,b){var c=this,e=na.call(arguments,1);return function(){return c.apply(a,e.concat(na.call(arguments)))}},
ba=oa.call(Function.prototype.call,Object.prototype.hasOwnProperty),da=g,E,u;a:{var W=document.createEvent("KeyboardEvent");try{W.initKeyboardEvent("keyup",l,l,n,"+",3,g,l,g,l,l);u="+"==(W.keyIdentifier||W.key)&&3==(W.keyLocation||W.location)&&(W.ctrlKey?W.altKey?1:3:W.shiftKey?2:4)||9;break a}catch(pa){}u=f}var v,ga,X=function(){try{return this&&new this("keyup",{key:"a","char":"b"})||{}}catch(a){return{}}}.call(n.KeyboardEvent),qa,s=l;T&&(G=U(N,"key")||U(X,"key"),O=U(N,"char")||U(X,"char"),P=U(N,
"location")||U(X,"location"),Q=U(N,"keyCode"));var A={3:"Cancel",6:"Help",8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",21:"KanaMode",22:"HangulMode",23:"JunjaMode",24:"FinalMode",25:"HanjaMode",27:"Esc",28:"Convert",29:"Nonconvert",30:"Accept",31:"ModeChange",32:"Spacebar",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"Left",38:"Up",39:"Right",40:"Down",41:"Select",43:"Execute",44:"PrintScreen",45:"Insert",46:"Del",47:"Help",91:{a:"OS",b:l,
c:I},92:{a:"OS",b:l,c:J},93:"Menu",106:{a:"Multiply",b:"*",c:K},107:{a:"Add",b:"+",c:K},108:{a:"Separator",b:l,c:K},109:{a:"Subtract",b:"-",c:K},110:{a:"Decimal",b:".",c:K},111:{a:"Divide",b:"/",c:K},144:{a:"NumLock",b:l,c:K},145:"ScrollLock",180:"LaunchMail",181:"SelectMedia",182:"LaunchApplication1",183:"LaunchApplication2",224:"Meta",229:"Process",246:"Attn",247:"Crsel",248:"Exsel",249:"EraseEof",251:"Zoom",254:"Clear"},z={48:{a:"0",b:"0",d:")",f:g},49:{a:"1",b:"1",d:"!",f:g},50:{a:"2"},51:{a:"3"},
52:{a:"4"},53:{a:"5",b:"5",d:"%",f:g},54:{a:"6"},55:{a:"7"},56:{a:"8",b:"8",d:"*",f:g},57:{a:"9",b:"9",d:"(",f:g},186:{a:";"},187:{a:"=",b:"=",d:"+",f:g},188:{a:","},189:{a:"-",b:"-",d:"_",f:g},190:{a:"."},191:{a:"/"},192:{a:"`"},219:{a:"["},220:{a:"\\"},221:{a:"]"},222:{a:"'"},226:{a:"\\"}},sa=n.navigator.userAgent.toLowerCase(),Y={},Z,B,$;for(Z=105;95<Z;--Z)z[Z]={a:Z-96+"",c:K};for(Z=135;111<Z;--Z)A[Z]="F"+(Z-111);if(n.opera)O||(B=g,A[57351]=A[93],z[187]=z[61]={a:0,e:187},z[189]=z[109]={a:0,e:189,
c:3});else{Y.names=sa.match(/(mozilla|compatible|chrome|webkit|safari)/gi);for(Z=Y.names&&Y.names.length||0;0<Z--;)Y[Y.names[Z]]=g;Y.mozilla&&(!Y.compatible&&!Y.webkit)&&(B=g,Y.j=+(sa.match(/firefox\/([0-9]+)/)||[])[1],z[61]={a:0,b:"=",d:"+",e:187},15>Y.j&&(A[107]=A[61],z[109]={a:0,b:"-",d:"_",e:189}))}var ea={"U+0008":k,"U+0009":k,"U+0020":k,"U+007F":k,Escape:k,Win:k,Scroll:k,Apps:k,"U+0010":k,"U+001C":k,"U+001D":k,"U+001E":k,"U+001F":k,Window:k,ContextMenu:k,Mul:k};x.DOM_KEY_LOCATION_STANDARD=0;
x.DOM_KEY_LOCATION_LEFT=I;x.DOM_KEY_LOCATION_RIGHT=J;x.DOM_KEY_LOCATION_NUMPAD=K;x.DOM_KEY_LOCATION_MOBILE=ja;x.DOM_KEY_LOCATION_JOYSTICK=ka;x.prototype=N;$=new x("keyup");try{delete $.keyCode,w($,"keyCode",{writable:g,value:9}),w($,"which",{writable:g,value:9})}catch(ta){}ga=9===$.which;!(v=9==$.keyCode)&&Q?(w(N,"keyCode",{enumerable:g,configurable:g,get:function(){return"__keyCode"in this?this.__keyCode:Q.call(this)},set:function(a){return this.__keyCode=isNaN(a)?0:a}}),w(N,"charCode",{enumerable:g,
configurable:g,get:function(){return"__charCode"in this?this.__charCode:Q.call(this)},set:function(a){return this.__charCode=isNaN(a)?0:a}})):Q=f;qa=function(a){if("keypress"==this.type)return a;a=a||"";if(1<a.length)return a;var b=this.which||this.keyCode,c=z[b],e=c&&c.a;if(e)return e;b=c&&c.e||64<b&&91>b&&b;return(b&&String.fromCharCode(b)||a).toLowerCase()};w(N,"key",{enumerable:g,configurable:g,get:function(){var a;if(G&&((a=G.call(this))&&2>a.length||y(a)))return this.__key=g,qa.call(this,a);
if("__key"in this)return this.__key;if(this instanceof x||this.type in V){var b=this.which||this.keyCode,c="keypress"!=this.type;c?"keyIdentifier"in this&&y(this.keyIdentifier)?a=this.keyIdentifier:!c||(a=A[b])?(a=a||z[b],a=("object"==typeof a?a.a:a)||this["char"]):a=qa.call(this,a):a=this["char"];return this.__key=a}}});w(N,"char",{enumerable:g,configurable:g,get:function(){var a;if(this.type in V){if(O&&(a=O.call(this))!==k)return this.__char=a;if("__char"in this)return this.__char;var b=this.which||
this.keyCode,c="keypress"!=this.type,e="object"==typeof(a=c&&z[b]||A[b]),d=e&&(a.b!==f||a.d!==f),c=(c||d)&&!this.shiftKey;a&&(!e||a.b===l)?a="":d?a=(c?a.b:a.d||a.b)||"":"keyIdentifier"in this&&y(this.keyIdentifier)?a="":(a=String.fromCharCode(b),c&&(a=a.toLowerCase()));return this.__char=a}}});E=function(){if(P)return P.call(this);if("__location"in this)return this.__location;if(this instanceof x||this.type in V){var a=this.which||this.keyCode,b="keypress"!=this.type;"keyLocation"in this?a=this.keyLocation:
(a=b&&(A[a]||z[a]),a="object"==typeof a&&a.c||0);return this.__location=a}};w(N,"location",{enumerable:g,configurable:g,get:E});O||[($=n.Document)&&$.prototype||n.document,($=n.HTMLDocument)&&$.prototype,($=n.Window)&&$.prototype||n,($=n.Node)&&$.prototype,($=n.Element)&&$.prototype].forEach(function(a){if(a&&a.hasOwnProperty("addEventListener")){var b=a.addEventListener,c=a.removeEventListener;b&&(a.addEventListener=function(a,c,j){var h,p,q;if("keydown"===(a+"").toLowerCase()){h="_e_8vj"+(j?"-":
"")+a;p=h+(c._h_9e2||(c._h_9e2=++ma));q=h+"__count";if(!(h=this._))h=this._={};if(p in h)return;h[q]===f&&b.call(this,"keypress",ia,g);h[q]=(h[q]||0)+1;arguments[1]=h[p]=oa.call(fa,{h:c,i:this})}return b.apply(this,arguments)},c&&(a.removeEventListener=function(a,b,j){var h,p,q;"keydown"===(a+"").toLowerCase()&&(h="_e_8vj"+(j?"-":"")+a,p=h+b._h_9e2,q=h+"__count",h=this._,p&&(h&&h[q])&&(--h[q],(arguments[1]=h[p])&&delete h[p]));return c.apply(this,arguments)}))}});I=J=K=ja=ka=T=$=X=k;n.KeyboardEvent=x}
})();